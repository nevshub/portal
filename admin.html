<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Admin Panel</h1>

  <!-- Music Player -->
  <div id="player">
    <audio id="audio" controls></audio>
    <input type="file" id="fileInput" accept="audio/*" multiple>
    <div id="playlist"></div>
  </div>

  <!-- Visualizer -->
  <canvas id="visualizer"></canvas>

  <!-- Customization Panel -->
  <div id="customization">
    <h2>Customization</h2>
    <label>
      Background Color:
      <input type="color" id="bgColor" value="#111111">
    </label>
    <label>
      Bar Color:
      <input type="color" id="barColor" value="#ff6600">
    </label>
    <label>
      Bar Width:
      <input type="range" id="barWidth" min="1" max="10" value="2">
    </label>
    <label>
      Sensitivity:
      <input type="range" id="sensitivity" min="10" max="256" value="64">
    </label>
  </div>

  <!-- Donation Section -->
  <div id="donationSection" style="margin-top:30px;">
    <h2>Donation Settings</h2>
    <p>Click below to donate via Cash App.</p>
    <button id="donateButton" class="button"
            onclick="window.open('https://cash.app/$YourCashtag', '_blank')">
      Donate Now
    </button>
  </div>

  <a href="index.html">Back to Home</a>

  <script>
    const audio = document.getElementById("audio");
    const fileInput = document.getElementById("fileInput");
    const playlist = document.getElementById("playlist");
    const canvas = document.getElementById("visualizer");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = 300;

    let audioCtx, analyser, source, dataArray;

    // Handle file selection
    fileInput.addEventListener("change", () => {
      playlist.innerHTML = "";
      Array.from(fileInput.files).forEach((file, index) => {
        const item = document.createElement("div");
        item.textContent = file.name;
        item.classList.add("playlist-item");
        item.onclick = () => loadTrack(file);
        playlist.appendChild(item);
        if (index === 0) loadTrack(file);
      });
    });

    function loadTrack(file) {
      const url = URL.createObjectURL(file);
      audio.src = url;
      audio.play();

      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        source = audioCtx.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(audioCtx.destination);
        analyser.fftSize = 512;
        dataArray = new Uint8Array(analyser.frequencyBinCount);
      }
    }

    // Circular visualizer reacting to bass and hi-hats
    function draw() {
      requestAnimationFrame(draw);
      if (!analyser) return;

      analyser.getByteFrequencyData(dataArray);

      // Colors
      const bgColor = document.getElementById("bgColor").value;
      const barColor = document.getElementById("barColor").value;

      // Clear canvas
      ctx.fillStyle = bgColor;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = 80;
      const totalBars = 60;

      ctx.save();
      ctx.translate(centerX, centerY);

      for (let i = 0; i < totalBars; i++) {
        const bassIndex = Math.floor(i * 2); // bass bins
        const hiHatIndex = dataArray.length - totalBars + i; // hi-hat bins
        const value = (dataArray[bassIndex] + dataArray[hiHatIndex]) / 2;

        const barLength = value * 0.8;
        const angle = (i / totalBars) * 2 * Math.PI;

        ctx.rotate(angle);
        ctx.fillStyle = barColor;
        ctx.fillRect(radius, -2, barLength, 4);
        ctx.rotate(-angle);
      }

      ctx.restore();
    }

    draw();
  </script>
</body>
</html>
